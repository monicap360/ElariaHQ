services:
  - type: web
    name: cruise-cards-site
    env: node
    plan: standard
    rootDir: cruise-cards-site
    healthCheckPath: /api/health
    # Build Command should install deps + build. On 512MB instances we skip all
    # heavy work and run a tiny maintenance server until upgraded.
    buildCommand: NODE_OPTIONS="--max-old-space-size=256" NEXT_TELEMETRY_DISABLED=1 SKIP_ENV_VALIDATION=true SKIP_TYPECHECK=true node ./build-render.js
    # Start Command should only start the HTTP server.
    startCommand: NEXT_TELEMETRY_DISABLED=1 node ./start-render.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: "20"
      # Hard cap runtime heap to survive 512MB instances.
      - key: RENDER_START_HEAP_MB
        value: "128"
